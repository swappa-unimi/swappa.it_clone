<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<title>Swappa :: Reti wireless - Bluetooth </title>
	<meta http-equiv='Content-Type' content='text/html; charset=ISO-8859-1' />
	<meta http-equiv='Content-Language' content='it' />
	<meta http-equiv='Content-Style-Type' content='text/css' />
	<meta http-equiv="imagetoolbar" content="no" />
	<meta name="robots" content="noarchive" />
	<meta name="verify-v1" content="W0mbMJBKN/iA23fcLw5UzRqXfwbh0SdGZ62YJgVCtqg=" />
	<meta name='description' content="Wiki creato da e per gli studenti del DTI dell'Università di Crema (Informatica, Sicurezza, DTI). Contiene appunti, riassunti, guide, esercizi, temi d'esame."  />
	<meta name='keywords' content="wiki, università, studenti, crema, appunti, riassunti, guide, informatica, sicurezza, esami, programmazione, recensioni, esercizi, progetti" />
	
  <link rel='icon' href='../pub/skins/sticWin/sticWinicon.gif.html' type='image/gif' />
  <link rel='SHORTCUT ICON' href='../pub/skins/sticWin/sticWinicon.gif.html' />
	<!--HeaderText--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .vspace { margin-top:1.33em; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  
.progress-bar {
	display: block;
	background: transparent; 
	width: 520px;
	font-size: 1px; /* for IE */
	margin: 2px 0;
}

.progress-bar .pb1, .progress-bar .pb2, .progress-bar .pb3, .progress-bar .pb4 {
	display: block; 
	background: #fff; 
	border-left:  1px solid #999; 
	border-right: 1px solid #999;

	overflow: hidden; 
	height: 1px; 
}
.progress-bar .pb1 { margin: 0 4px; background: #999;}
.progress-bar .pb2 { margin: 0 2px; border-width: 0 2px; }
.progress-bar .pb3 { margin: 0 1px; }
.progress-bar .pb4 { height: 11px; padding: 0 3px; }
.progress-bar .pb5 { display: block; background: #eeeeef; overflow:hidden; }

.progress-bar .bar {
	display: block;
	background: #a5bbd8;
	height: 11px;
	padding: 0;
}
.editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
   
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style>
  <link rel='stylesheet' href='../pub/wsplus/wsplus.css' 
    type='text/css' />
  <!--[if IE]><style type='text/css' media='screen'>
    body { behavior:url('http://www.swappa.it/wiki/pub/wsplus/csshover.htc'); }
    .rollover * { visibility: visible; }
  </style><![endif]-->
<script type='text/javascript' src='../pub/syntaxlove/scripts/shCore.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushCSharp.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushCpp.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushJava.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushPerl.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushPhp.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushPython.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushRuby.js'></script> <link type='text/css' rel='stylesheet' href='../pub/syntaxlove/css/shCore.css'/>
  <link type='text/css' rel='stylesheet' href='../pub/syntaxlove/css/shThemeDefault.css'/>
  <script type='text/javascript'>
  	SyntaxHighlighter.config.clipboardSwf = 'http://www.swappa.it/wiki/pub/syntaxlove/scripts/clipboard.swf';
  	SyntaxHighlighter.all();
  </script>  <meta name='robots' content='index,follow' />
  <link rel='stylesheet' href='../pub/skins/sticWin/sticWin.css' type='text/css' />
  
</head>

<body>
	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-5744461-3']);
	  _gaq.push(['_trackPageview']);

	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>

	<!--PageHeaderFmt-->
	<table summary='Site: Header' id='siteheadtable' width='960'
	cellpadding='0' cellspacing='0' border='0' align='center'>
		<tr>
			<td colspan='2' id='navi'>
			<table width='420' cellpadding='0' cellspacing='0' align='right'>
			<tr>
				<td id='navi' width='300'>
					<!-- Inizio Codice Shinystat -->
					<script type="text/javascript" language="JavaScript" src="http://codice.shinystat.com/cgi-bin/getcod.cgi?USER=swappa"></script>
					<noscript>
					<a href="http://www.shinystat.com/it" target="_top">
					<img src="http://www.shinystat.com/cgi-bin/shinystat.cgi?USER=swappa" alt="Contatori visite gratuiti" border="0"></a>
					</noscript>
					<!-- Fine Codice Shinystat -->
				</td>
				<td id='riemp2'></td>
				<td id='navi' width='80'>
					<a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.5/it/">
						<img alt="Creative Commons License" style="border-width:0" height="15" width="80" src="http://i.creativecommons.org/l/by-nc-sa/2.5/it/80x15.png" />
					</a>
				</td>
			
				<td id='riemp5'></td>
				
			</tr>
			</table>
			</td>	
		</tr>
		<tr>
			<td colspan='2' id='siteheadfind'>
				<a href='../Site.Search.html'
				title='Cerca nel sito' rel='nofollow'>cerca</a> 
				<form class='siteheadfind search' action='../index.html'>
				<input class='searchbox' type='text' name='q' value='' size='40' />
				<input class='searchbut' type='submit' value='vai' />
				<!-- version > beta53 -->
				<!-- <input type='hidden' name='n' value='Uni.RW-23-27Aprile' /><input type='hidden' name='action' value='search' /> -->
				<!-- version < beta53 -->
				<input type='hidden' name='n' value='Site.Search' />
				</form>
			</td>					
		</tr>
		<tr><td id='riemp1'></td></tr>
		<tr>
			<td id='pagetitle' width='560'>
				Reti wireless - Bluetooth
			</td>
			<td id='siteheadcmds'>
			<table width='360' cellpadding='0' cellspacing='0' align='right'>
			<tr>
				<td id='siteheadmenu'>
					<a rel='nofollow' href='http://www.swappa.it/wiki/Uni/RW-23-27Aprile?action=edit' title='Modifica la pagina'>modifica</a>
				</td> 
				<td id='siteheadmenu'>
					<a  rel='nofollow' href='http://www.swappa.it/wiki/Uni/RW-23-27Aprile?action=diff' title='Ultime modifiche della pagina'>cronologia</a>
				</td>
				<td id='siteheadmenu'>
					<a  rel='nofollow' href='RW-23-27Aprile-action=print.html' title='Stampa la pagina'>stampa</a>
				</td>	
				<td id='riemp5'></td>
				<td id='log'>
					<a rel='nofollow' href='http://www.swappa.it/wiki/Uni/RW-23-27Aprile?action=login' title='Login'>login</a>
				</td>	
				<td id='log'>
					<a rel='nofollow' href='http://www.swappa.it/wiki/Uni/RW-23-27Aprile?action=logout' title='Logout'>logout</a>
				</td>	
				<td id='riemp2'></td>
			</tr>
			</table>
			</td>				
		</tr>  
		
	</table>
	<!--/PageHeaderFmt-->

	<table summary='Site: Main' id='contentmain' width='960'
	cellpadding='0' cellspacing='0' border='0' align='center'>
	<tbody>
		<tr>
			<td id='riemp2'></td>
			<!--PageLeftFmt-->
			<td id='mainsidebar'>
			
			<p class='sidehead'> Wiki
</p><ul><li><a class='wikilink' href='../Main/HomePage.html'>HomePage</a>
</li><li><a class='wikilink' href='http://www.swappa.it/wiki/Main/Forum'>Forum</a>
</li><li><a target='_blank'  class='urllink' href='http://www.swappa.it/gallery/main.php' title='' rel='nofollow'>Galleria</a>
</li></ul><p class='vspace sidehead'> UniCrema
</p><ul><li><a class='wikilink' href='../Category/UniCrema.html'>Tutte le materie</a>
</li><li><a class='wikilink' href='../Category/Docenti.html'>Docenti</a>
</li><li><a class='wikilink' href='Progetti.html'>Progetti</a>
</li></ul><p><br clear='all' />
</p>
<p class='vspace sidehead'> Materie per semestre
</p><ul><li><a class='wikilink' href='../Category/PrimoSemestre.html'>Primo semestre</a>
</li><li><a class='wikilink' href='../Category/SecondoSemestre.html'>Secondo semestre</a>
</li></ul><p class='vspace sidehead'> Materie per anno
</p><ul><li><a class='wikilink' href='../Category/PrimoAnno.html'>Primo anno</a>
</li><li><a class='wikilink' href='../Category/SecondoAnno.html'>Secondo anno</a>
</li><li><a class='wikilink' href='../Category/TerzoAnno.html'>Terzo anno</a>
</li><li><a class='wikilink' href='../Category/ComplementariOMagistrale.html'>Complem. / magistrale</a>
</li></ul><p class='vspace sidehead'> Materie per laurea
</p><ul><li><a class='wikilink' href='../Category/Informatica.html'>Informatica</a>
</li><li><a class='wikilink' href='../Category/Sicurezza.html'>Sicurezza</a>
</li><li><a class='wikilink' href='../Category/TS.html'>TS</a>
</li></ul><p><br clear='all' />
</p>
<p class='vspace sidehead'> Help
</p><ul><li><a class='wikilink' href='http://www.swappa.it/wiki/Category/GuideInterneWiki'>Guide interne</a>
</li><li><a class='wikilink' href='../Main/FAQ.html'>FAQ</a>
</li></ul><div class='vspace'></div>

			
				<div id='sidebarbottom'>
					<span style='white-space:nowrap;'>
						<a  rel='nofollow' href='http://validator.w3.org/check/referer'
						title='Validate XHTML'>XHTML</a>
					</span>
				</div>
			</td>
			<!--/PageLeftFmt-->
			<td id='riemp1'></td>
			<td id='mainsitetext'>
				<!-- table to work around an NS4 bug -->
				<table summary='Content Body' id='sitebody'
				cellpadding='0' cellspacing='0' border='0'> 
					<tr>
						<td>
							<!--PageTitleFmt-->
							<div id='sitepagetitle'
							title='Reti wireless - Bluetooth was last modified on June 14, 2010, at 03:02 PM'>
							<span style='display:none;'>Reti wireless - Bluetooth</span>	
							</div>
							<!--PageText-->
<div id='wikitext'>
<p>
<a name='su' id='su'></a>
<a class='wikilink' href='RetiWireless.html'>Torna alla pagina di Reti wireless</a>
</p><hr />
<div class='vspace'></div><pre  style='text-align: center; background-color: #ffe4c4; border: 2px solid #cccccc; font-size: 13pt; padding: 5px;'> <strong>:: Reti wireless - Bluetooth ::</strong>
</pre><p class='vspace'  style='text-align: center;'><span  style='background-color: #d9e4f2; font-size: 11pt; padding: 4px; padding-left: 50px; padding-right: 50px;'>Appunti del 23-27 Aprile</span>
</p>
<div class='vspace'></div><div class='frame' > 
<p>Le immagini di questa pagina sono prese dalle slide del prof <a class='wikilink' href='GiovanniRapacioli.html'>Rapacioli</a>
</p></div>
<div class='vspace'></div><div  style='text-align: left; background-color: #f5f9fc; width: 240px; border: 2px solid #cccccc; padding: 5px;' > 
<p  style='text-align: center;'><strong>Indice</strong>
</p>
<div class='vspace'></div><ol><li><a href='#b1'>Introduzione</a>
</li><li><a href='#b2'>Caratteristiche e versioni</a>
</li><li><a href='#b3'>Piconet</a>
</li><li><a href='#b4'>Frequency hop</a>
</li><li><a href='#b5'>Stack Bluetooth</a>
</li><li><a href='#b6'>Tipi di traffico</a>
</li><li><a href='#b7'>Trasmissione dei pacchetti</a>
</li><li><a href='#b8'>Correzione degli errori</a>
</li><li><a href='#b9'>Stati e connessione</a>
</li><li><a href='#b10'>Pacchetti</a>
</li><li><a href='#b11'>Sicurezza e pairing</a>
</li><li><a href='#b12'>Profili</a>
</li><li><a href='#b13'>Comparative</a>
</li></ol></div>
<div class='vspace'></div><hr />
<p class='vspace'><a name='b1' id='b1'></a>
</p><h2>Introduzione</h2>
<p>Il <strong>Bluetooth</strong> è una specifica per reti personali wireless (WPAN), pensata per consumare e costare poco. L'idea originaria è partita da Ericsson nel 1994, a cui si sono aggregati nel tempo un bel numero di società (IBM, Intel, Nokia, Toshiba, ... oggi sono circa 2500) che nel 1998 hanno fondato il Bluetooth Special Interest Group (SIG). Insieme al gruppo è arrivata anche la standardizzazione da parte della IEEE, che certifica il protocollo come 802.15.1 . <br />Nota di folklore: il nome arriva dal re danese Harald Blåtand, dove Blåtand significa "dente blu" (blue tooth, anglofonicamente parlando). Perché proprio lui? Perché così come il buon Harald riuscì a unificare Danimarca e Norvegia sotto il suo regno (cosa non banale, dato il carattere dei vichinghi), così lo standard Bluetooth riesce a far comunicare dispositivi completamente diversi. Wow, già.<br />Altra nota di folklore: il logo del protocollo è la sovrapposizione delle rune nordiche che compongono le iniziali di Harald Blåtand. Magnifico.
</p>
<div class='vspace'></div><div  style='text-align: center;'><img src='http://mondodyne.com/b2b/Bluetooth_Logo.gif' alt='' title='' /></div>
<p class='vspace'>Le caratteristiche tecniche del Bluetooth e la sua semplicità di configurazione lo rendono particolarmente adatto per essere implementato su oggetti di uso quotidiano che non richiedono grandi competenze tecniche. L'utilizzo classico è "auricolare-cellulare", ma come ben sappiamo viene utilizzato per collegare un gran numero di oggetti, dai palmari alle stampanti, dalle fotocamere ai gamepad della Play Station (anche se la <a target='_blank'  class='urllink' href='http://images2.wikia.nocookie.net/__cb20090110041725/nonciclopedia/images/d/d4/Wii_gnocca.gif' title='' rel='nofollow'>gente per bene</a> preferisce il Bluetooth dei WiiMote). Semplicità d'uso significa che il riconoscimento e il collegamento deve essere triviale, quasi automatico.
</p>
<p class='vspace'>Concludiamo l'introduzione con le solite beghe di utilizzo del marchio. Chiunque voglia vendere il proprio dispositivo Bluetooth col suo bel logo sopra, deve registrarsi presso il SIG, compilare una serie di moduli che spieghino cos'è e cosa fa il suo prodotto, pagare circa 1000$ (cifra non monumentale) e ottenere il suo identificativo univoco di 48 bit. Che ce ne facciamo? Tante cose che vedremo man mano. <br />Ovviamente nessuno può impedirmi di creare una radio Bluetooth e usarla su un mio dispositivo, ma se non la certifico non posso venderla come Bluetooth.
</p>
<p class='vspace'><a href='#su'><span style='font-size:83%'><strong>Torna su</strong></span></a>
</p>
<p class='vspace'><a name='b2' id='b2'></a>
</p><h2>Caratteristiche e versioni</h2>
<p>Come già anticipato, il Bluetooth è stato progettato per reti WPAN, quindi con un corto raggio di azione, e per avere una buona autonomia (da 1 a 7 giorni). Le due cose sono strettamente collegate tra loro dal momento che l'area di copertura dipende dalla potenza in uscita dell'antenna, e che all'aumentare di questa aumentano anche i consumi energetici. In base alla potenza dell'antenna possiamo distinguere tre classi di dispositivi: classe 1 (100mW -&gt; copertura: 100m), classe 2 (2,5mW -&gt; copertura: 10m), classe 3 (1mW -&gt; copertura: meno di un metro).<br />Lo standard Bluetooth prevede la trasmissione di onde radio nella banda di frequenze ISM (Industrial Scientific Medical, riservata ad impieghi civili), ovvero 2.4 GHz. In particolare essa utilizza 83.5 MHz di questa banda, che divide in 79 canali (vedremo poi perché). Si noti che essendo basato su onde radio non richiede puntamento diretto tra dispositivi, limite di cui invece soffriva l'IrDA.
</p>
<p class='vspace'>Lo standard Bluetooth si è molto evoluto nel tempo, portando correzioni e migliorie nelle varie versioni di rilascio. Le principali innovazioni riguardano la sicurezza (nelle prime versioni ci voleva poco per fregare i dati altrui), la velocità di trasmissione (dal limite di 720 Kb/s ora si può arrivare a 3 Mb/s), migliorie nella comunicazione (maggiore qualità, minori consumi) ed altro ancora. Il 21 aprile 2010 il SIG ha completato la stesura delle specifiche per il core della versione 4.0, ma per il rilascio completo si parla di fine anno/inizio 2011 (<a class='urllink' href='http://www.bluetooth.com/English/PRESS/Pages/NewsDetail.aspx?ID=186' title='' rel='nofollow'>http://www.bluetooth.com/English/PRESS/Pages/NewsDetail.aspx?ID=186</a>).
</p>
<p class='vspace'><a href='#su'><span style='font-size:83%'><strong>Torna su</strong></span></a>
</p>
<p class='vspace'><a name='b3' id='b3'></a>
</p><h2>Piconet</h2>
<p>Un gruppo di dispositivi collegati tra loro in Bluetooth formano una rete chiamata <strong>piconet</strong>, in cui si possono distinguere un master (unico) e più slave. Il master non si limita a creare la piconet e darle un nome, ma gestisce l'allocazione dei canali, le comunicazioni, la sincronizzazione del clock con gli altri partecipanti e la sequenza dei salti di frequenza (tutte cose che vedremo poi). Quando un nuovo dispositivo entra nella piconet il master gli chiede come si chiama e cosa sa fare (=che protocolli supporta), così da capire in che "lingua" dovrà parlare con lui. Questa attività riassumibile con "ci conosciamo e capiamo cosa possiamo fare" si chiama <em>discovery</em>. Si noti che due slave non possono comunicare direttamente tra loro, ma devono sempre passare dal master come intermediario, a meno che non siano ancora nella fase di discovery.
</p>
<p class='vspace'>Le topologie di rete sono di tre tipi: punto a punto (1 master 1 slave), punto a multipunto (1 master + slave), scatternet (più piconet collegate tra loro). Nel caso delle scatternet c'è uno slave che fa da ponte tra due piconet, quindi parteciperà contemporaneamente ad entrambe. Pur essendo assolutamente previste, pochi sviluppatori investono tempo nel progettare soluzioni di questo tipo, perché poco utili nella pratica e altamente incasinate da implementare.
</p>
<p class='vspace'>Una piconet supporta al massimo 8 dispositivi, di cui uno è il master. Ovviamente stiamo parlando di quelli connessi al master della mia piconet, o in luoghi affollati come aeroporti o aule gremite non si riuscirebbe mai ad unirsi ad una. A questo proposito vale la pena distinguere tre tipi di slave: 
</p><ul><li><em>active slave</em>, che partecipano attivamente alla piconet sia in ricezione che in trasmissione, e sono sincronizzati col master. Possono essere massimo 7;
</li><li><em>standby slave</em>, non connesso e quindi non coinvolto nelle attività della piconet. Si dice anche che sono in modalità risparmio energetico, e possono essere un numero indefinito;
</li><li><em>parked slave</em>, che sono attivi ma non stanno comunicando. Sonnecchiano consumando poco e rimanendo sincronizzati alla piconet ascoltando su 32 canali invece dei 79. In questo modo si riesce ad avere più di 7 dispositivi agganciati al master, anche se il numero di quelli che possono trasmettere rimane invariato.
</li></ul><p class='vspace'>Il master continua a <em>switchare</em> tra i dispositivi della piconet secondo una strategia round-robin. La modalità broadcast per comunicazioni simultanee con più nodi è prevista e possibile (facendo time-division multiplexing), ma non è troppo utilizzata.
</p>
<p class='vspace'><a href='#su'><span style='font-size:83%'><strong>Torna su</strong></span></a>
</p>
<p class='vspace'><a name='b4' id='b4'></a>
</p><h2>Frequency hop</h2>
<p>Il Bluetooth usa la tecnica del <strong>frequency hop</strong> (salto di frequenza) per aumentare la larghezza di banda del segnale e renderla più immune alle interferenze. Essa consiste nel cambiamento a intervalli regolari della frequenza di trasmissione, secondo una sequenza pseudocasuale prestabilita. Ecco spiegato il motivo per cui il Bluetooth si riservava 79MHz: assegnando un canale ad ogni MHz di frequenza ottiene 79 canali tra cui fare frequency hopping.
</p>
<p class='vspace'>Ogni chip Bluetooth ha associato un identificativo univoco sulla faccia della terra (grazie alla lungimirante e lucrosa gestione del SIG), che ogni potenziale master può usare come seme di un algoritmo per la generazione pseudocasuale di una sequenza di frequenze. Una piconet è quindi formata da slave in accordo col master sulla sequenza da lui comunicata, così anche se continuano a parlarsi su frequenze diverse si trovano sempre. Considerando che in un secondo di trasmissione dati si hanno 1600 salti (diventano 3200 nelle fasi di inquiry e paging), va da sé che la sincronizzazione è fondamentale: se ci disaccoppiamo di 0.625 microsecondi (un <em>time slot</em>) non ci becchiamo più. 
</p>
<p class='vspace'>La probabilità che la sequenza di una piconet coincida in qualche istante con quella di un'altra è normalmente molto bassa. Le probabilità di collisioni aumentano all'aumentare di piconet e dispositivi ad esse connessi, da cui i limiti fissati dal protocollo.
</p>
<p class='vspace'><a href='#su'><span style='font-size:83%'><strong>Torna su</strong></span></a>
</p>
<p class='vspace'><a name='b5' id='b5'></a>
</p><h2>Stack Bluetooth</h2>
<div  style='text-align: center;'><img src='../uploads/Uni/RW-stackBT.gif' alt='' title='' /></div>
<div class='vspace'></div><ul><li><strong>Bluetooth Radio</strong>, è lo strato fisico che definisce i requisiti della parte in radio frequenza (classi di dispositivi, potenza dell'antenna, frequenze utilizzate, ...);
</li><li><strong>Bluetooth Baseband</strong>, che abilita il collegamento fisico tra dispositivi all'interno di una piconet. Tra gli altri aspetti di cui si occupa vi sono la gestione di: clock, formato dei pacchetti dati, ruoli master/slave, controllo dei collegamenti e delle trasmissioni audio, correzione degli errori;
</li><li><strong>Link Manager Protocol</strong> (LMP), responsabile dell'inizializzazione configurazione e autenticazione del collegamento. Si occupa inoltre di controllare i diversi stati dei dispositivi (attivi/standby/parked/..) all'interno della piconet;
</li><li><strong>Logical Link &amp; Adaptation Layer</strong> (L2CAP), si trova allo stesso livello dell'LMP ma usa le sue direttive per stabilire il link. Tra gli altri compiti esegue il multiplexing dei protocolli di livello superiore, la segmentazione e il riassemblaggio dei pacchetti;
</li><li><strong>RFCOMM</strong>, è il protocollo che emula una porta seriale RS-232 sull'L2CAP (in realtà ne emula 60), permettendo così che il Bluetooth supporti tutte quei protocolli che usano meccanismi di trasmissione seriale (OBEX, TCP/IP/PPP, WAP). Per questo motivo viene chiamato "sostitutivo del cavo";
</li><li><strong>Service Discovery Protocol</strong> (SDP), elemento fondamentale poiché permette ai dispositivi di comunicare i protocolli da loro supportati, dunque i servizi che offrono/richiedono. Si noti che la discovery dei servizi parte subito dopo l'autenticazione tra dispositivi, ovvero dopo la discovery tra i nodi;
</li><li><strong>Telephony</strong>, ovvero protocolli telefonici. Ad essi si riconducono gli <strong>AT-Command</strong>, comandi standard pensati per la gestione dei modem, e quindi per la gestione di una connessione di tipo telefonico attraverso comandi seriali. Permettono ad esempio di aprire o chiudere connessioni audio, alzare o abbassare il volume, ...;
</li><li><strong>Audio</strong>, che codifica il segnale audio ed è interfacciato direttamente col livello Baseband. E' una delle ragioni di successo del Bluetooth: l'audio si sente bene e funziona benone.
</li></ul><p class='vspace'>I primi tre layer (Bluetooth Radio, Bluetooth Baseband, LMP) possono essere considerati come la parte firmware dello stack, perché associati al componente hardware che fa la trasmissione radio; sono chiamati anche <em>controller</em>. Al di sopra di essi si collocano i protocolli software, nel loro insieme individuati come <em>host</em>, poiché legati all'ambiente in cui la radio opera. In figura non si vede (potete vederlo <a target='_blank'  class='urllink' href='http://cgi.cse.unsw.edu.au/~cs4411/wiki/images/a/a9/Bluetooth_stack.jpg' title='' rel='nofollow'>qui</a> ), ma tra queste due sezioni si colloca l' <strong>Host to Controller Interface</strong> (HCI), che è opzionale e come il nome stesso suggerisce fa da interfaccia comune ad entrambi.
</p>
<p class='vspace'><a href='#su'><span style='font-size:83%'><strong>Torna su</strong></span></a>
</p>
<p class='vspace'><a name='b6' id='b6'></a>
</p><h2>Tipi di traffico</h2>
<p>Come facilmente intuibile dal paragrafo precedente, il Bluetooth gestisce sostanzialmente due tipi di traffico:
</p><ul><li><em>traffico audio</em>, che è simmetrico (ho due canali, uno di ingresso e uno di uscita), sincrono e orientato alla connessione (<strong>SCO</strong>, <em>Synchronous Connection-Oriented</em> link). Orientato alla connessione significa che apre un canale tra master e slave e lo tiene aperto per tutto il tempo della comunicazione; è una scelta sensata dal momento che sta trattando un flusso audio continuo. Non c'è controllo dell'errore, quindi nessuna ritrasmissione dei pacchetti corrotti o non ricevuti (se capisci capisci, se no pazienza). Un master può supportare al massimo tre canali audio attivi contemporaneamente (per limiti di banda), su cui trasmette a 64 Kb/s per slot;
</li><li><em>traffico dati</em>, che utilizza gli slot lasciati liberi da quello audio, e che è asincrono e non orientato alla connessione (<strong>ACL</strong>, <em>Asynchronous Connectionless Link</em>). Può essere sia simmetrico che asimmetrico e prevede la correzione degli errori con ritrasmissione dei pacchetti. Lo slave può trasmettere solo se nello slot precedente aveva ricevuto un pacchetto dal master.
</li></ul><p class='vspace'><a href='#su'><span style='font-size:83%'><strong>Torna su</strong></span></a>
</p>
<p class='vspace'><a name='b7' id='b7'></a>
</p><h2>Trasmissione dei pacchetti</h2>
<p>L'unità di misura della trasmissione dati Bluetooth è il pacchetto, che può estendersi per 1, 3 o 5 time slots consecutivi. Come è strutturato un pacchetto lo vedremo qualche paragrafo più avanti, per il momento ci basta sapere che è formato da un header con tutte le informazioni del caso e da un payload. Introduciamo alcune caratteristiche del processo di trasmissione a partire da questa immagine:
</p>
<div class='vspace'></div><div  style='text-align: center;'><img src='../uploads/Uni/RW-BTpackTras.gif' alt='' title='' /></div>
<p class='vspace'>Considerazioni:
</p><ul><li>i 625 microsecondi di un time slot non sono tutti utilizzati, ma c'è una guard time di silenzio (220microsecondi) che evita che i pacchetti si sovrappongano;
</li><li>gli indici dei time slot (f<sub>0</sub>, f<sub>1</sub>, f<sub>2</sub>, ...) hanno valori pseudocasuali, ovviamente non sono sequenziali (o l'utilità del frequency hopping andrebbe a ramengo);
</li><li>la trasmissione può avvenire solo tra master e slave e tra slave e master (a meno che due slave non siano in fase di discovery);
</li><li>master e slave trasmettono a turni, secondo una tecnica di <em>Time Division Duplex</em> (TDD);
</li><li>se il pacchetto da trasmettere è lungo più di un time slot, sarà trasmesso sempre alla stessa frequenza. La risposta però non avverrà sulla frequenza successiva a quella di trasmissione, ma a quella a cui si sarebbe dovuti arrivare se avessimo avuto tutti pacchetti da 1. Guardando l'immagine in alto si capisce meglio: in f<sub>2</sub> si trasmette un pacchetto che occupa tre time slot, ma la frequenza di risposta usata non è f<sub>3</sub>, bensì f<sub>5</sub> (f<sub>2+3</sub>).
</li></ul><p class='vspace'><a href='#su'><span style='font-size:83%'><strong>Torna su</strong></span></a>
</p>
<p class='vspace'><a name='b8' id='b8'></a>
</p><h2>Correzione degli errori</h2>
<p>Nel paragrafo precedente abbiamo dato per scontato che le comunicazioni vadano sempre a buon fine, cosa ovviamente poco realistica. Il meccanismo che implementa il Bluetooth per la correzione degli errori è l'invio di pacchetti di acknowledgement (ACK) o not-acknowledgement (NACK) a seconda che la trasmissione del pacchetto sia andata o meno a buon fine. Si tratta di un sistema semplice ma estremamente funzionale, utilizzato dalla totalità dei protocolli wireless e da molti di tipo wired.<br />Anche in questo caso illustreremo il funzionamento a partire da una figura:
</p>
<div class='vspace'></div><div  style='text-align: center;'><img src='../uploads/Uni/RW-BTerrori.gif' alt='' title='' /></div>
<p class='vspace'>Tre osservazioni iniziali:
</p><ol><li>ad ogni pacchetto è associato un bit chiamato <em>sequence number</em> (SEQN), un booleano che vale alternativamente 0 e 1 a seconda del valore dell'ultimo pacchetto inviato correttamente;
</li><li>l'ACK (o il NACK) è inviato nel time slot immediatamente successivo a quello di ricezione, mai alla stessa frequenza. Inoltre non è un segnale generico, ma dipende dal contenuto del pacchetto perché mi indica il SEQN di quello a cui si riferisce;
</li><li>la comunicazione può fallire in entrambe le direzioni di trasmissione: dal master allo slave (mancato ricevimento del pacchetto) o dallo slave al master (mancato ricevimento dell'ACK)
</li></ol><p class='vspace'>Torniamo alla figura. Nei primi due time slot il master invia un pacchetto con sequence number pari a 0 allo slave (in f<sub>0</sub>) e questi gli risponde correttamente con un ACK (in f<sub>1</sub>) che arriva a destinazione. Nessun errore, niente correzioni necessarie, tutti felici. Il sequence number viene portato a 1.<br />In f<sub>2</sub> il master manda un nuovo pacchetto, che però non arriva correttamente allo slave; ad esempio ha un CRC sbagliato, non è arrivato prima del timeout, mancano porzioni nell'header, eccetera. In f<sub>3</sub> lo slave manda allora un pacchetto NACK per segnalare la trasmissione fallita, indicando anche il SEQN del pacchetto che non ha ricevuto, ovvero l'1, così che il master sappia quale dovrà ritrasmettere.<br />In f<sub>4</sub> il master re-invia il pacchetto con sequence number pari a 1 che stavolta arriva in modo corretto. In f<sub>5</sub> lo slave invia l'ACK, ma in questo caso è la sua trasmissione a fallire, ad esempio perché c'è stata una collisione con un altro dispositivo che trasmetteva in quel momento alla stessa frequenza di f<sub>5</sub>. Il master che si aspettava un ACK in quel time slot, non avendolo ricevuto manda per l'ennesima volta il pacchetto con SEQN=1 in f<sub>6</sub> perché il ciclo non si è ancora chiuso. Stavolta va tutto bene: l'ACK è spedito e ricevuto in f<sub>7</sub> e il sequence number viene riportato a 0. Tutto qui.
</p>
<p class='vspace'>Ora possiamo capire più facilmente perché la correzione degli errori si fa solo su comunicazioni asincrone e non anche sul flusso voce: continue interruzioni dovute alle ritrasmissioni dei pacchetti corrotti si avvertirebbero e renderebbero la conversazione fastidiosa, mentre su traffico dati sono praticamente impercettibili.
</p>
<p class='vspace'><a href='#su'><span style='font-size:83%'><strong>Torna su</strong></span></a>
</p>
<p class='vspace'><a name='b9' id='b9'></a>
</p><h2>Stati e connessione</h2>
<p>In generale i dispositivi Bluetooth possono essere nei tre stati principali che abbiamo già visto, ovvero <em>standby</em>, <em>connected</em> (o <em>attivi</em>) e <em>parked</em>. Esistono poi una serie di sottostati da cui bisogna passare per stabilire una connessione e abilitare i dispositivi alla fase di discovery. Il passaggio tra questi sottostati avviene attraverso comandi che partono dal link manager LMP o da segnali interni del link controller (ad esempio segnali di timeout).<br />Vediamo ora come avviene la connessione tra due dispositivi Bluetooth:
</p>
<div class='vspace'></div><div  style='text-align: center;'><img src='../uploads/Uni/RW-BTconnection.gif' alt='' title='' /></div>
<p class='vspace'>La procedura di <strong>inquiry</strong> permette al potenziale master di fare la discovery dei dispositivi a portata di antenna, o viceversa al potenziale slave di essere rilevato. L'intera operazione avviene sullo strato fisico dello stack, con la formazione di una canale fisico temporaneo il cui frequency hopping è limitato a 32 sole frequenze (distribuite equamente sui 79 MHz totali) dette di <em>wake-up</em>. Se un nodo in standby riceve un pacchetto di inquiry IAC su tali frequenze, si sente interrogato dall'ambiente e deve decidere se partecipare o meno alla piconet. Se sì, si passa allo procedura di <strong>paging</strong>, in cui lo slave viene interrogato sui servizi (profili) di cui dispone e invitato a partecipare alla piconet instaurando una connessione grazie alle informazioni inviate dal master (la sequenza di hopping, la sincronizzazione col clock, il suo indirizzo nella piconet, ...). Il canale fisico messo a disposizione per la procedura di paging è specifico per la coppia di dispositivi protagonisti, e se questa va a buon fine entrano finalmente in modalità <strong>connected</strong>.
</p>
<p class='vspace'><a href='#su'><span style='font-size:83%'><strong>Torna su</strong></span></a>
</p>
<p class='vspace'><a name='b10' id='b10'></a>
</p><h2>Pacchetti</h2>
<p>Un generico pacchetto Bluetooth è formato da tre parti: 
</p><ul><li><strong>Access Code</strong> (AC), usato per l'identificazione della piconet e la sincronizzazione delle trasmissioni. Si noti che gli slave non accettano pacchetti con AC che non corrispondono all'identità del loro master. Esistono tre tipi di Access Code, a seconda delle modalità in cui può essere il dispositivo: <em>Channel Access Code</em> (CAC, che identifica la piconet), <em>Device Access Code</em> (DAC, usato in fase di paging per la creazione di una nuova connessione) e <em>Inquiry Access Code</em> (IAC, da usare nella procedura di inquiry). Può essere lungo 72bit o 68bit a seconda che sia seguito da un <em>header</em> o sia trasmesso da solo;
</li><li><strong>header</strong>, lungo 18bit e a sua volta suddiviso in sei parti: AM_ADDR (indirizzo temporaneo assegnato ad un dispositivo nella piconet), TYPE (il codice di 4 bit che identifica il tipo di pacchetto, ad esempio audio o dati), FLOW (per il controllo del flusso in una comunicazione audio), ARQN (per l'ACK/NACK), SEQN (il sequence number già visto) e l'HEC (per il controllo dell'integrità dell'header);
</li><li><strong>payload</strong>, il contenuto vero e proprio della trasmissione. Può essere lungo da 0 a 2745bit e può essere o dati o voce.
</li></ul><p class='vspace'><a href='#su'><span style='font-size:83%'><strong>Torna su</strong></span></a>
</p>
<p class='vspace'><a name='b11' id='b11'></a>
</p><h2>Sicurezza e pairing</h2>
<p>Con il rilascio delle nuove versioni del Bluetooth si è sempre tenuto un occhio di riguardo per la sicurezza del protocollo, correggendo le varie falle man mano che si scoprivano e introducendo strategie più sicure per l'autenticazione e la trasmissione dei dati.<br />Il <strong>pairing</strong> è un meccanismo che realizza il duplice obiettivo di controllare quali dispositivi possono connettersi al mio, e stabilire automaticamente delle connessioni con quelli considerati sicuri (<em>trusted</em>) quando arrivano a portata di antenna. Ciò è implementato attraverso lo scambio di una chiave segreta condivisa (l'operazione è effettuata in genere direttamente dall'utente), che può essere ulteriormente raffinato introducendo diversi livelli di crittazione (ad esempio dell'identità dell'altro, dei certificati scambiati o dell'intero traffico). I motivi dietro questi raffinamenti, introdotti dalla versione 2.1 del Bluetooth, erano che con un semplice scambio chiavi in chiaro (generalmente di 4 cifre) si è particolarmente esposti ad attacchi brute-force, e il fatto che le piconet abbiano un'estensione ridotta non è una buon motivo per stare tranquilli dato che eventuali attaccanti potrebbero munirsi di antenne bibliche per intercettare gli scambi.<br />Gli algoritmi di pairing, crittazione e gestione delle chiavi sfruttano 4 parametri: device address (l'id univoco del dispositivo, pubblico), chiave segreta di autenticazione, chiave privata segreta (il numero che si scambiano master e slave), numero pseudocasuale.
</p>
<p class='vspace'>Il livello di sicurezza può essere settato lato utente. In particolare, tutti gli apparati Bluetooth permettono di configurare almeno 4 opzioni che rispondono alle seguenti domande:
</p><ul><li>voglio essere interrogato? Se sì, rimango in ascolto sui famosi 32 canali di wake-up e nel caso mi aggrego a una piconet, altrimenti mi faccio i fatti miei
</li><li>voglio interrogare?
</li><li>voglio fare pairing?
</li><li>il pairing deve essere permanente o temporaneo? Ad esempio, se devo farlo con un mio amico a cui devo passare una foto non ha senso farlo permanente, mentre ne ha se voglio collegare la mia auricolare al cellulare
</li></ul><p class='vspace'><a href='#su'><span style='font-size:83%'><strong>Torna su</strong></span></a>
</p>
<p class='vspace'><a name='b12' id='b12'></a>
</p><h2>Profili</h2>
<p>Le possibili applicazioni per il Bluetooth sono numerose, e ancora più numerosi sono i profili definiti per identificarle. Ecco un tabellone con qualche esempio:
</p>
<div class='vspace'></div><div  style='text-align: center;'><img src='../uploads/Uni/RW-BTprofili.gif' alt='' title='' /></div>
<p class='vspace'>Il fatto di avere tanti profili ha dei pro e dei contro: se ne definisco pochissimi poi ci saranno problemi di compatibilità perché sarà demandata a livello applicativo (e nessuno si vuole prendere la briga di assicurarla), mentre se ne definisco troppi sono pesantemente vincolato in quello che posso fargli fare. E' la solita coperta troppo corta.
</p>
<div class='vspace'></div><div class='round lrindent evvai' > 
<p><strong>Ipse dixit:</strong><br />"E poi diciamolo, la maggior parte si differenzia per cazzate. 
</p></div>
<p class='vspace'><a href='#su'><span style='font-size:83%'><strong>Torna su</strong></span></a>
</p>
<p class='vspace'><a name='b13' id='b13'></a>
</p><h2>Comparative</h2>
<div  style='text-align: center;'><img src='../uploads/Uni/RW-BTcomparativa.gif' alt='' title='' /></div>
<p class='vspace'>Concludiamo facendo notare che tra i tanti criteri in base ai quali scelgo i protocolli wireless da utilizzare per le mie soluzioni, non è affatto da trascurare la grandezza dei loro stack. Essa è infatti direttamente collegata alle risorse che richiede al sistema, non solo come peso sulla memoria ma anche sulla capacità di elaborazione del microprocessore integrato. Ad esempio, i device su cui gira lo Zigbee non supporterebbero neanche per scherzo la trasmissione via TCP/IP (dove infilerebbero il suo monumentale stack nei miseri 32Kb a disposizione?). Altro esempio, non posso pensare di mettere un processore a 32bit in un'auricolare per fargli fare autonomamente VoIP, a meno che non voglia attaccare un calcolatore all'orecchio degli utenti.
</p>
<p class='vspace'><a href='#su'><span style='font-size:83%'><strong>Torna su</strong></span></a>
</p>
<div class='vspace'></div><hr />
<p><a class='wikilink' href='RetiWireless.html'>Torna alla pagina di Reti wireless</a>
</p>
</div>

						</td>
					</tr>
				</table>
			</td>
		</tr>
		<tr>
			<td id='foot' colspan='4' rowspan='1'>
				<table summary='Wiki: Footer' width='100%' cellpadding='0' cellspacing='0' border='0'>
				<!--PageFooterFmt-->
				<tr>
					<td id='footleft'>
					<span id='footchanges'>
						<a  rel='nofollow' href='RecentChanges.html'
						title='Ultime modifiche della sezione'
						accesskey='c'>Ultime modifiche</a>
						<a  rel='nofollow' href='http://www.swappa.it/wiki/Site.AllRecentChanges'
						title='(Tutte le modifiche del sito'
						accesskey='a'>(Tutte)</a>
					</span>
					<span id='footeditsb'>| 
						<a  rel='nofollow' href='http://www.swappa.it/wiki/Site.SideBar?action=edit'
						title='Modifica la barra laterale'
						accesskey='b'>edit SideBar</a>
					</span>
					</td>
					<td id='footmiddle'>
					<span id='footlastmod'>Ultimo aggiornamento: June 14, 2010, at 03:02 PM</span> 
					</td>
					<td id='footright'>
					<span id='footedit'>
						<a  rel='nofollow' href='http://www.swappa.it/wiki/Uni/RW-23-27Aprile?action=edit'
						title='Modifica la pagina'
						accesskey='e'>Modifica</a>
					</span>
					<span id='foothist'>| 
						<a  rel='nofollow' href='http://www.swappa.it/wiki/Uni/RW-23-27Aprile?action=diff'
						title='Ultime modifiche della pagina'
						accesskey='h'>Cronologia</a>
					</span> 
					</td>
				</tr>
				<!--/PageFooterFmt-->
				</table>
			</td>
		</tr>
	</tbody>
	</table>

	</body>
	
</html>
 
 
