<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
 <title>Swappa : Uni / Sistemi Operativi - Appunti caotici</title>
 <meta http-equiv='Content-Type' content='text/html; charset=ISO-8859-1' />
 <meta http-equiv='Content-Language' content='en' />
 <meta http-equiv='Content-Style-Type' content='text/css' />
 <meta http-equiv="imagetoolbar" content="no" />
 <meta name='MSSmartTagsPreventParsing' content='true' />
 <!--HeaderText--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .vspace { margin-top:1.33em; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  
.progress-bar {
	display: block;
	background: transparent; 
	width: 520px;
	font-size: 1px; /* for IE */
	margin: 2px 0;
}

.progress-bar .pb1, .progress-bar .pb2, .progress-bar .pb3, .progress-bar .pb4 {
	display: block; 
	background: #fff; 
	border-left:  1px solid #999; 
	border-right: 1px solid #999;

	overflow: hidden; 
	height: 1px; 
}
.progress-bar .pb1 { margin: 0 4px; background: #999;}
.progress-bar .pb2 { margin: 0 2px; border-width: 0 2px; }
.progress-bar .pb3 { margin: 0 1px; }
.progress-bar .pb4 { height: 11px; padding: 0 3px; }
.progress-bar .pb5 { display: block; background: #eeeeef; overflow:hidden; }

.progress-bar .bar {
	display: block;
	background: #a5bbd8;
	height: 11px;
	padding: 0;
}
.editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
   
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style>
  <link rel='stylesheet' href='../pub/wsplus/wsplus.css' 
    type='text/css' />
  <!--[if IE]><style type='text/css' media='screen'>
    body { behavior:url('http://www.swappa.it/wiki/pub/wsplus/csshover.htc'); }
    .rollover * { visibility: visible; }
  </style><![endif]-->
<script type='text/javascript' src='../pub/syntaxlove/scripts/shCore.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushCSharp.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushCpp.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushJava.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushPerl.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushPhp.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushPython.js'></script><script type='text/javascript' src='../pub/syntaxlove/scripts/shBrushRuby.js'></script> <link type='text/css' rel='stylesheet' href='../pub/syntaxlove/css/shCore.css'/>
  <link type='text/css' rel='stylesheet' href='../pub/syntaxlove/css/shThemeDefault.css'/>
  <script type='text/javascript'>
  	SyntaxHighlighter.config.clipboardSwf = 'http://www.swappa.it/wiki/pub/syntaxlove/scripts/clipboard.swf';
  	SyntaxHighlighter.all();
  </script>  <meta name='robots' content='noindex,nofollow' />

 <style type='text/css'><!--

/* Default Fonts */
body { font-family: Verdana,Arial,Helvetica,sans-serif; }
body, td, th { color:#000000; }
body, td, th { font-size: 10pt; }
small { font-size:0.85em; }
code { white-space: nowrap; }
h1, h2, h3, h4, h5 { margin-top:1em; margin-bottom:0.6em; }
h1 { font-size: 1.9em; }
h2 { font-size: 1.5em; }
h3 { font-size: 1.25em; }
h4 { font-size: 1.06em; }
h5 { font-size: 1.0em; }
ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }

/* Misc. */
body { width:auto; background-color:#ffffff; margin:0px; padding:0.5em; }
img { border-width: 0px; }
.indent { margin-left:30px; }
.outdent { margin-left:30px; text-indent:-30px; }
.vspace { margin-top:1.33em; }

/* Links */
a:link { color:#333333; font-weight:normal; text-decoration:underline; }
a:visited { color:#333333; font-weight:normal; text-decoration:underline; }
a.wikilink:hover { color: #333333; text-decoration:underline; }
a.createlink { text-decoration:none; position:relative; top:-0.5em; font-weight:bold; font-size:smaller; border-bottom:none; }
a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
a.varlink { text-decoration:none; }
.apprlink { font-size:smaller; }

/* Print View Page Header */
#printhead { font-size:11pt; border-bottom:2px solid #a0a0a0; margin-bottom:1em; }
#printhead a, #printhead a:visited { font-weight:bold; text-decoration:none; }
#cc { float:right; font-size:11pt; border-bottom:2px solid #a0a0a0; margin-bottom:1em; }

/* Print View Page Footer */
#printfoot { font-family: Arial,Helvetica,Geneva,sans-serif; margin-top:1em; border-top:2px solid #a0a0a0; font-size:7pt; }
  
 --></style>
</head>
<body>
  <div id='printhead'>
    <a href='../index.html' title='Swappa Home'>Swappa</a> :
    <a href='http://www.swappa.it/wiki/Uni' title='Uni Home'>Uni</a> /
    <a href='SO-Mod3-5-Lez2.html' title='Sistemi Operativi - Appunti caotici'>Sistemi Operativi - Appunti caotici</a>
    <div id='cc'>
	<a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.5/it/">
	<img alt="Creative Commons License" style="border-width:0" height="15" width="80" src="http://i.creativecommons.org/l/by-nc-sa/2.5/it/80x15.png" />
	</a>
    </div>
  </div>
  
<!--PageText-->
<div id='wikitext'>
<p>
<a class='wikilink' href='SistemiOperativi.html'>Torna alla pagina di Sistemi Operativi</a>
</p><hr />
<div class='vspace'></div><pre  style='text-align: center; background-color: #ffe4c4; border: 2px solid #cccccc; font-size: 13pt; padding: 5px;'> <strong>:: Appunti caotici ::</strong>
</pre><p class='vspace'  style='text-align: center;'><span  style='background-color: #d9e4f2; font-size: 11pt; padding: 4px; padding-left: 50px; padding-right: 50px;'>Lezione 2</span>
<span  style='background-color: #d9e4f2; font-size: 11pt; padding: 4px; padding-left: 50px; padding-right: 50px;'>Variabili di lock</span>
</p>
<div class='vspace'></div><h2>Pag 1</h2>
<h4>Sommario</h4>
<p>...
</p>
<div class='vspace'></div><h2>Pag 2</h2>
<h4>Variabile di turno</h4>
<p>E' una variabile condivisa tra i processi che interagiscono per accedere in modo condiviso alla risorsa, stabilendone il turno (ovvero a quale processo spetta il diritto di uso in un certo istante).
</p>
<div class='vspace'></div><h4>Sincronizzazione di due processi concorrenti mediante variabile di turno</h4>
<p>Nell'utilizzo dei buffer andava tutto bene fin tanto che si leggeva e si scriveva, il problema nasce quando bisogna effettuare degli aggiornamenti. Il problema nello specifico è che se il buffer era pieno il processo si bloccava per depositare il suo messaggio e si impediva l'aggiornamento dell'indice. Ecco perchè devo garantire una sincronizzazione che effettuo con la variabile di turno.
</p>
<div class='vspace'></div><h2>Pag 3</h2>
<h4>Algoritmo 1</h4>
<p>Questo algoritmo scritto in java prevede l'uso di una variabile di turno condivisa.
</p>
<p class='vspace'>Commentiamo alcune parti del codice:
</p>
<div class='vspace'></div><ul><li><pre class='escaped'>public Algorithm 1() {
   turn = TURN 0;
}</pre><br />Inizializza a 0 la variabile di turno, quindi dà la possibilità al processo 0 di accedere alla propria porzione critica
<div class='vspace'></div></li><li><pre class='escaped'>public void enteringCriticalSection (int t) {
   while (turn != t)
      Thread.yield();
}</pre><br />Il processo 0 può accedere all'uso della risorsa condivisa. A un qualsiasi altro processo (con valore t diverso da 0) viene invece impedito l'accesso, rimanendo bloccato nella funzione di attesa yield().
<div class='vspace'></div></li><li><pre class='escaped'>public void leavingCriticalSection (int t) {
   turn = 1 - t;
}</pre><br />Quando il processo 0 avrà terminato le sue operazioni nella porzione critica, concederà l'uso delle risorse condivise all'altro processo assegnando alla variabile turn il nuovo valore. Avendo in questo caso due soli processi, l'alternanza dei valori della variabile viene realizzata con "1-t".
</li></ul><p class='vspace'>Caratteristiche dell'algoritmo:
</p><ul><li>garantisce la mutua esclusione dei processi, dal momento che quando è in esecuzione uno, l'altro è in attesa
</li><li>impone una stretta alternanza dei processi, con tutti gli svantaggi che questo comporta. Se ad esempio ho un produttore che vuole deporre più informazioni durante il suo turno, non potrà farlo perché dovrà prima aspettare che il consumatore esaurisca il suo (e viceversa)
</li><li>non garantisce il progresso, dato che non lascio evolvere il processo fino ai suoi limiti naturali. Nel caso del consumatore il limite naturale è l'aver letto tutte le informazioni, mentre per il produttore è ritrovarsi col buffer pieno.
</li></ul><div class='vspace'></div><h4>Algoritmo 2</h4>
<p>Anche in questo caso commentiamo alcune porzioni di codice: 
</p>
<div class='vspace'></div><ul><li><code class='escaped'>private volatile boolean flag0, flag1</code>
</li></ul><p>Utilizzo due variabili booleane di flag per riferirmi allo stato dei processi
</p>
<div class='vspace'></div><ul><li><pre class='escaped'>public Algorithm 2() {
   flag0 = false; flag1 = false;
}</pre><br />Inizializza entrambi i flag a false per indicare che i processi non vogliono ancora entrare nella sezione critica. 
<div class='vspace'></div></li><li><pre class='escaped'>public void enteringCriticalSection (int t) {
   if (t == 0) {
      flag0 = true;
      while (flag1 == true)
         Thread.yield();
   }
   else {
      flag1 = true;
      while (flag0 == true)
         Thread.yield();
   }
}</pre><br />Se il processo che vuole accedere alla risorsa è lo 0, marchio flag0 a true e nel caso in cui flag1 sia a true (nel caso cioè che un altro processo stia già usando la risorsa condivisa) attendo che finisca.
<div class='vspace'></div></li><li><pre class='escaped'>public void leavingCriticalSection (int t) {
   if(t == 0) flag0 = false; else flag1 = false;
}</pre><br />Quando un processo termina le sue operazioni sulla sezione condivisa, pone il proprio flag uguale a false.
</li></ul><p class='vspace'>Caratteristiche dell'algoritmo:
</p><ul><li>non impone stretta alternanza dei processi, dato che chi arriva controlla dai valori dei flag se può accedere alla risorsa
</li><li>mutua esclusione garantita dal punto precedente
</li><li>non garantisce il progresso
</li><li>possibile attesa infinita
</li></ul><div class='vspace'></div><h2>Pag 4</h2>
<h4>Algoritmo 3</h4>
<p>Anche in questo caso commentiamo alcune porzioni di codice: 
</p>
<div class='vspace'></div><ul><li><pre class='escaped'>public void enteringCriticalSection (int t) {
   int other = 1 - t;
   turn = other;
   if (t == 0) {
      flag0 = true;
      while (flag1 == true &amp;&amp; turn == other)
         Thread.yield();
   }
   else {
      flag1 = true;
      while (flag0 == true &amp;&amp; turn == other)
         Thread.yield();
   }
}</pre><br />Grazie all'assegnamento <code class='escaped'>turn = other</code>, la prossima volta che viene lanciata la funzione passo <code class='escaped'>other</code> come parametro (l'altro processo) così che se non deve fare nulla ripassa immediatamente il turno all'altro, altrimenti esegue le operazioni che deve fare nel suo turno.
</li></ul><p class='vspace'>Caratteristiche dell'algoritmo:
</p><ul><li>garantisce la mutua esclusione
</li><li>garantisce il progresso
</li></ul><div class='vspace'></div><h4>Variabile di lock</h4>
<p>La variabile di lock non guarda più lo stato di uso dei processi, quindi il diritto d'uso di un processo, ma lo stato di uso di una risorsa.
</p>
<div class='vspace'></div><h2>Pag 5</h2>
<h4>Uso ad interruzioni disabilitate</h4>
<p>Acquisizione della risorsa:
</p><ul><li>disabilito le interruzioni
</li><li>leggo la variabile di lock
</li><li>se la risorsa libera (lock = 0), la marco in uso ponendo lock = 1 e riabilito le interruzioni, tanto ormai è stato marcato nel sistema operativo
</li><li>se la risorsa è in uso (lock = 1), riabilito le interruzioni e pongo il processo in attesa che la risorsa si liberi
</li></ul><p class='vspace'>Notare come questi passaggi siano sequenze di operazioni assembler, quindi interrompibili per definizione. Devo perciò garantire che siano loro stesse una porzione critica, disabilitando appunto le interruzione.
</p>
<p class='vspace'>Rilascio della risorsa:
</p><ul><li>pongo lock = 0
</li></ul><div class='vspace'></div><h4>Hardware per la sincronizzazione</h4>
<p>Vegono in pratica introdotti nell'hardware del processore dei meccanismi per ottenere la sincronizzazione.
</p>
<p class='vspace'>L'istruzione atomica <strong>TEST-AND-SET</strong> traduce la sequenza di istruzioni precedenti in una sola.
</p>
<p class='vspace'>Se però la soluzione vista nella slide precedente è percorribile dal programmatore, questa è perseguibile esclusivamente dal progettista del processore.
</p>
<div class='vspace'></div><hr />
<p><a class='wikilink' href='SistemiOperativi.html'>Torna alla pagina di Sistemi Operativi</a>
</p>
</div>

  <div id='printfoot'>
    <div class='printview'>(Printable View of <span style='white-space:nowrap;'>http://www.swappa.it/wiki/Uni/SO-Mod3-5-Lez2)</span></div>
  </div>
</body>
</html>
